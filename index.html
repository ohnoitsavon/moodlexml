<!DOCTYPE html>
<html>
    <script src="jquery-3.4.1.min.js">
    </script>
<body>
<h2>Moodle XML Helper</h2>
<p>Q QUESTION TYPE (eg multichoice, shortanswer, truefalse, numerical)</p>
<p>N QUESTION NAME</p>
<p>T QUESTION TEXT</p>
<p>A = ANSWER (correct answer)</p>
<p>A ~ ANSWER (incorrect answer)</p>
<p>A 50 ANSWER (percent correct answer)</p>
<p>AT = ANSWER (use instaed of A if providing feedback)</p>
<p>AF FEEDBACK (use after AT to provide feedback)</p>
<p>SINGLE TRUE/FALSE (toggles single multiple answers)</p>
<p>SHUFFLE TRUE/FALSE (toggles shuffle answers)</p>
<p>SELECT QUESTION NUMBERS/LETTERS (eg abc, ABCD, 123, iii, IIII, none)</p>
<p>END</p>



<p id="demo"></p>
<textarea rows="30" style="width:100%;max-width: 600px;">
</textarea>
<br><button onclick="convertxml()">Convert to XML</button> 
<script>
//document.getElementById("demo").innerHTML = "Test JS";
function convertxml(){
    var questiondata = '<?xml version="1.0" encoding="UTF-8"?><quiz>';
    var singleanswer = 0;
    var shuffleanswers = "n/a";
    var answernumbering = 0;
    var waitforfeedback = 0;
    var lines = $('textarea').val().split('\n');
    for(var i = 0;i < lines.length;i++){
        //console.log(lines[i])
        var html1 = ""
        var html2 = ""
        var trigger = lines[i].substr(0,lines[i].indexOf(' '))
        var message = lines[i].substr(lines[i].indexOf(' ')+1)

        if(trigger.toUpperCase() != "FB" && waitforfeedback == 1) {
            waitforfeedback = 0;
            questiondata += '</answer>';
        }

        //code here using lines[i] which will give you each line
        switch (trigger.toUpperCase())
        {
            case "Q":
                switch (message.toUpperCase())
                {
                    case "MC":
                    case "MULTICHOICE":
                        questiondata += '<question type="multichoice">';
                        singleanswer = "true"
                        shuffleanswers = "0"
                        answernumbering = "abc"
                        html1 = "<![CDATA[<p>"
                        html2 = "</p>]]>"
                    break;
                    case "TF":
                    case "TRUEFALSE":
                        questiondata += '<question type="truefalse">';
                    break;
                    case "SA":
                    case "SHORTANSWER":
                        questiondata += '<question type="shortanswer">';
                        html1 = "<![CDATA[<p>"
                        html2 = "</p>]]>"
                    break;
                    case "NUM":
                    case "NUMERICAL":
                        questiondata += '<question type="numerical">';
                    break;
                    //matching
                    //essay
                    //cloze
                            //usecase for short answer
                }
            break;
            case "N":
                questiondata += '<name><text>'+message+'</text></name>'
            break;
            case "T":
                questiondata += '<questiontext format="html"><text><![CDATA[<p>'+message+'</p>]]></text></questiontext>'    
            break;
            case "A":
                var atrigger = message.substr(0,message.indexOf(' '))
                var amessage = message.substr(message.indexOf(' ')+1)
                var fraction = 0;
                switch (atrigger.toUpperCase())
                {
                    case "=":
                        fraction = "100";
                    break;

                    case "~":
                        fraction = "0";
                    break;

                    case "100":
                    case "90":
                    case "83.33333":
                    case "80":
                    case "75":
                    case "70":
                    case "66.66667":    
                    case "60":
                    case "50":
                    case "40":
                    case "33.33333":
                    case "30":
                    case "25":
                    case "20":
                    case "16.66667":
                    case "14.28571":
                    case "12.5":    
                    case "11.11111":
                    case "10":
                    case "5":
                    case "0":
                    case "-100":
                    case "-90":
                    case "-83.33333":
                    case "-80":
                    case "-75":
                    case "-70":
                    case "-66.66667":    
                    case "-60":
                    case "-50":
                    case "-40":
                    case "-33.33333":
                    case "-30":
                    case "-25":
                    case "-20":
                    case "-16.66667":
                    case "-14.28571":
                    case "-12.5":    
                    case "-11.11111":
                    case "-10":
                    case "-5":
                        fraction = atrigger;
                    break;

                    case "1/9": 
                        fraction = "11.11111";
                    break;

                    case "1/8": 
                        fraction = "12.5";
                    break;
                    
                    case "1/7": 
                        fraction = "14.28571";
                    break;
                    
                    case "1/6": 
                        fraction = "16.66667";
                    break;
                    
                    case "1/3": 
                        fraction = "33.33333";
                    break;
                    
                    case "2/3": 
                        fraction = "66.66667";
                    break;
                    
                    case "5/6": 
                        fraction = "83.33333";
                    break;
                     
                    case "-1/9": 
                        fraction = "-11.11111";
                    break;
                    
                    case "-1/8": 
                        fraction = "-12.5";
                    break;
                    
                    case "-1/7": 
                        fraction = "-14.28571";
                    break;
                    
                    case "-1/6": 
                        fraction = "-16.66667";
                    break;
                    
                    case "-1/3": 
                        fraction = "-33.33333";
                    break;

                    case "-2/3": 
                        fraction = "-66.66667";
                    break;
                    
                    case "-5/6": 
                        fraction = "-83.33333"
                    break;

                }

                waitforfeedback = 1;
                questiondata += '<answer fraction="'+fraction+'"><text>'+html1+amessage+html2+'</text>'; 
                
            break;
            case "FB":
                waitforfeedback = 0;
                questiondata += '<feedback format="html"><text><![CDATA[<p>'+message+'</p>]]></text></feedback></answer>';
            break;
            case "SINGLE":
                if (message.toUpperCase() == "TRUE" || message.toUpperCase() == "1")
                {
                    singleanswer = "true"
                }
                else
                {
                    if (message != "")
                    {
                        singleanswer = "false"
                    }
                    else
                    {
                        singleanswer = "true"  
                    }
                }
            break;
            case "SHUFFLE":
                if (message.toUpperCase() == "TRUE" || message.toUpperCase() == "1")
                {
                    shuffleanswers = "1"
                }
                else
                {
                    if (message != "")
                    {
                        shuffleanswers = "0"
                    }
                    else
                    {
                        shuffleanswers = "1" 
                    }
                }
            break;
            case "SEL":
            case "SELECT":
                switch (message)
                {
                    case "abc":
                    case "ABCD":
                    case "123":
                    case "iii":
                    case "IIII":
                    case "none":
                        answernumbering = message;
                    break;
                    case "ABC":
                        answernumbering = "ABCD";
                    break;
                    case "III":
                        answernumbering = "IIII";
                    break;
                    case "NONE":
                        answernumbering = "none";
                    break;
                }
            break;
        }

        switch (lines[i].toUpperCase())
        {
            case "END":
                if (singleanswer != 0)
                {
                    questiondata += '<single>'+singleanswer+'</single>'
                }
                
                if (shuffleanswers != "n/a")
                {
                    questiondata += '<shuffleanswers>'+shuffleanswers+'</shuffleanswers>'
                }
                
                if (answernumbering != 0)
                {
                    questiondata += '<answernumbering>'+answernumbering+'</answernumbering>'
                }



                questiondata += '</question>';
                //resetvars
                singleanswer = 0;
                shuffleanswers = "n/a";
                answernumbering = 0;
                var waitforfeedback = 0;
            break;
            case "SINGLE":
                singleanswer = "true"   
            break;
            case "MULTI":
            case "MULTIPLE":
                singleanswer = "false"
            break;
            case "SHUFFLE":
                shuffleanswers = "true"
            break;
        }
    }       
    questiondata += '</quiz>';
    //console.log(questiondata);
    download("quiz.xml",questiondata);
}

function download(filename, text) {
  var element = document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
  element.setAttribute('download', filename);

  element.style.display = 'none';
  document.body.appendChild(element);

  element.click();

  document.body.removeChild(element);
}
</script>
</body>
</html>
